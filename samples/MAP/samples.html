<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>MAP class samples </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="MAP class samples ">
    <meta name="generator" content="docfx 2.56.7.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    <meta property="docfx:newtab" content="true">
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="map-class-samples">MAP class samples</h1>

<p>This section shows common samples of how to create and manage <strong>DIV Games Studio</strong> graphic maps.</p>
<p>A <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> object is the image format used by <strong>DIV Games Studio</strong> to represents a 
bitmap or texture in his engine. Is basically a simple uncompressed bitmap with a palette (a 
<a class="xref" href="../../api/DIV2.Format.Exporter.PAL.html">PAL</a> data). One interesting feature of the <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> 
format is the <a class="xref" href="../../api/DIV2.Format.Exporter.ControlPoint.html">Control Point</a> list.</p>
<p>A <a class="xref" href="../../api/DIV2.Format.Exporter.ControlPoint.html">Control Point</a> is a coordinate, in <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a>
bitmap space, that represents a &quot;hot spot&quot;, like how works in the Windows Cursor images. This point coordinates are
relatives to the image bitmap but are translated to the screen space when you draw the 
<a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> image.</p>
<p>This feature helps the programmer to define the logical center of the image, used to for draw, rotate and scale 
operations, but also, and is the main useful usage, to easily place other objects related with the 
<a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> position in screen (e.g. a ship engine particle or a bullet from a weapon barrel).</p>
<p>By default, all <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> images has a default 
<a class="xref" href="../../api/DIV2.Format.Exporter.ControlPoint.html">Control Point</a> that reference the center of the image. You can overwrite
the default <a class="xref" href="../../api/DIV2.Format.Exporter.ControlPoint.html">Control Point</a> coordinates and create new ones as many you need, 
with a limit of 1000 points in total.</p>
<div class="NOTE"><h5>Note</h5><p>Only the first <a class="xref" href="../../api/DIV2.Format.Exporter.ControlPoint.html">Control Point</a> is used as center of the image for draw, 
rotate and scale operations.</p>
</div>
<p>The <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> format also contains other data like a <strong>graph id</strong> and a 
<strong>description</strong> fields. The <strong>graph id</strong> is used as index to reference a <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> 
image. The <strong>description</strong> is an optional field used to add a little description of the image.</p>
<div class="NOTE"><h5>Note</h5><p>The <strong>graph id</strong> value is not required for standalone <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> images (in this case, 
<strong>DIV Games Studio</strong> assigned one when you load a <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> from a file).
This field value only is required when you want to store the image in a <a class="xref" href="../../api/DIV2.Format.Exporter.FPG.html">FPG</a> file.</p>
</div>
<h2 id="create-a-new-map-graphic">Create a new MAP graphic</h2>
<p>This code shows how to create an empty 64x128 <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> instance, with a <strong>graph id</strong> 
and a <strong>description</strong> values. You can omit these fields to use default values:</p>
<pre><code class="lang-csharp" name="Main">var palette = new PAL(&quot;DIV.PAL&quot;);
var map = new MAP(palette, 64, 128, 12, &quot;Test map.&quot;);
</code></pre><h2 id="load-a-map-graphic">Load a MAP graphic</h2>
<p>This code shows how to load an existing <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> file:</p>
<pre><code class="lang-csharp" name="Main">var map = new MAP(&quot;PLAYER.MAP&quot;);
</code></pre><p>Also you can load a <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> file from a <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.byte">byte</a> array:</p>
<pre><code class="lang-csharp" name="Main">byte[] buffer = System.IO.File.ReadAllBytes(&quot;PLAYER.MAP&quot;);
var map = new MAP(buffer);
</code></pre><h2 id="import-a-supported-image-format">Import a supported image format</h2>
<p>This code shows how to import a supported image file (JPEG, PNG, BMP, GIF, TGA and PCX) as 
<a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> image. The process converts all original colors to a 8 bits (256 colors) format:</p>
<pre><code class="lang-csharp" name="Main">var map = MAP.FromImage(&quot;PLAYER.PNG&quot;);
</code></pre><div class="WARNING"><h5>Warning</h5><p>PCX import feature only supports 8 bits (256 colors) PCX images. If you try to import a PCX image with other BPP 
format, you thrown an exception.</p>
</div>
<h2 id="converts-all-colors-to-a-specific-palette">Converts all colors to a specific palette</h2>
<p>When you imports a supported image file, you can also specify a <a class="xref" href="../../api/DIV2.Format.Exporter.PAL.html">PAL</a> instance to
convert the original colors to a specific colors:</p>
<pre><code class="lang-csharp" name="Main">var palette = new PAL(&quot;DIV.PAL&quot;);
var map = MAP.FromImage(&quot;PLAYER.PNG&quot;, palette);
</code></pre><div class="NOTE"><h5>Note</h5><p>You can imports <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> files to apply color conversion.</p>
</div>
<h2 id="write-bitmap-colors">Write bitmap colors</h2>
<p>You can write a palette color index from the bitmap using the pixel index:</p>
<pre><code class="lang-csharp" name="Main">map[42] = 224; // Writes the color index 224 in the pixel index 42.
</code></pre><p>Also you can use the pixel coordinates to write it:</p>
<pre><code class="lang-csharp" name="Main">map[32, 24] = 224; // Writes the color index 224 in the pixel located in x32 y24.
</code></pre><p>If you need to write all bitmap data in one step you can use this way:</p>
<pre><code class="lang-csharp" name="Main">... // Creates a 64x64 MAP image.
var bitmap = new byte[64 * 64]; // Creates a 64x64 byte array.
... // Sets color indexes in each pixel.
map.SetBitmapArray(bitmap);
</code></pre><div class="NOTE"><h5>Note</h5><p>Remember that the bitmap pixels store the color index in the assigned palette, a value from 0 to 255, instead 
the RGB-DAC values.</p>
</div>
<h2 id="read-bitmap-colors">Read bitmap colors</h2>
<p>You can read a palette color index from the bitmap using the pixel index:</p>
<pre><code class="lang-csharp" name="Main">byte colorIndex = map[42]; // Reads the color index from pixel index 42.
</code></pre><p>Also you can use the pixel coordinates to read it:</p>
<pre><code class="lang-csharp" name="Main">byte colorIndex = map[32, 24]; // Reads the color index from pixel located in x32 y24.
</code></pre><p>Also you can read each pixel using a foreach loop:</p>
<pre><code class="lang-csharp" name="Main">foreach (byte colorIndex in map)
{
    Console.WriteLine(colorIndex); // Prints the color index of the current pixel.
}
</code></pre><p>If you need to read all bitmap data you can use this way:</p>
<pre><code class="lang-csharp" name="Main">byte[] bitmap = map.GetBitmapArray();
</code></pre><h2 id="get-the-rgb-texture">Get the RGB texture</h2>
<p>If you need, for example, render the bitmap in a custom tool, that works with full RGB 24/32 bits, you can get a 
copy of the all colors in RGB format [0..255] using a simple call:</p>
<pre><code class="lang-csharp" name="Main">Color[] texture = map.GetRGBTexture();
</code></pre><h2 id="clear-all-bitmap-data">Clear all bitmap data</h2>
<p>You can erase all bitmap data using this call. This method sets all pixels to zero, the first color of the palette
(usually expected black color for transparency):</p>
<pre><code class="lang-csharp" name="Main">map.Clear();
</code></pre><h2 id="manage-control-points">Manage Control Points</h2>
<p>The management of the <a class="xref" href="../../api/DIV2.Format.Exporter.ControlPoint.html">Control Point</a>s list is the same as the 
<a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.list-1">List&lt;T></a> generic class.</p>
<p>You can read any point using his index in the list:</p>
<pre><code class="lang-csharp" name="Main">ControlPoint point = map.ControlPoints[0]; // Reads the first/default control point.
</code></pre><p>Also you can read each one using a foreach loop:</p>
<pre><code class="lang-csharp" name="Main">foreach (ControlPoint point in map.ControlPoints)
{
    Console.WriteLine(point); // Prints the Control Point coordinates.
}
</code></pre><p>Use the <strong>Add</strong> method to add new point to the list:</p>
<pre><code class="lang-csharp" name="Main">map.ControlPoints.Add(new ControlPoint(16, 16)); // Adds a new Control Point in x16 y16.
</code></pre><p>Use the <strong>RemoveAt</strong> method to remove a point using his index position:</p>
<pre><code class="lang-csharp" name="Main">map.ControlPoints.RemoveAt(2); // Removes the third (index 2) Control Point.
</code></pre><p>And use the <strong>Clear</strong> method to remove all points:</p>
<pre><code class="lang-csharp" name="Main">map.ControlPoints.Clear();
</code></pre><div class="NOTE"><h5>Note</h5><p>Don&#39;t worry if you keep empty the <a class="xref" href="../../api/DIV2.Format.Exporter.ControlPoint.html">Control Point</a>s list. By default,
if not exists any point, <strong>DIV Games Studio</strong> created a default one with the center coordinates of the bitmap.</p>
</div>
<h2 id="get-or-set-the-graphid-value">Get or set the GraphID value</h2>
<p>You can get or set the <strong>graph id</strong> value using the following property:</p>
<pre><code class="lang-csharp" name="Main">int graphId = map.GraphId;
</code></pre><pre><code class="lang-csharp" name="Main">map.GraphId = 10;
</code></pre><div class="NOTE"><h5>Note</h5><p>This value is only required when you want to store the <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> in a 
<a class="xref" href="../../api/DIV2.Format.Exporter.FPG.html">FPG</a> file. If you want to load the image from a file instead, this value is
omitted and <strong>DIV Games Studio</strong> assigned one automatically. By default, this value is 1.</p>
</div>
<div class="WARNING"><h5>Warning</h5><p>If you try to sets a value under 1 or over 999, you thrown an exception.</p>
</div>
<h2 id="get-or-set-the-description-value">Get or set the Description value</h2>
<p>You can get or set the <strong>description</strong> value using the following property:</p>
<pre><code class="lang-csharp" name="Main">string description = map.Description;
</code></pre><pre><code class="lang-csharp" name="Main">map.Description = &quot;A simple description.&quot;;
</code></pre><div class="NOTE"><h5>Note</h5><p>The <strong>description</strong> field has a limit of 32 characters. You can enter any <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a> value with more of 32 characters, 
but when you save the <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> file, this field save only the first 32 characters.
This field is optional.</p>
</div>
<h2 id="save-map-graphic-to-a-file">Save MAP graphic to a file</h2>
<p>You can easily save your changes to a <a class="xref" href="../../api/DIV2.Format.Exporter.MAP.html">MAP</a> file using the following call:</p>
<pre><code class="lang-csharp" name="Main">map.Save(&quot;NEWMAP.MAP&quot;);
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span><center><strong>DIV2.Format.Exporter</strong> © Visual Studio EX3, José Miguel Sánchez Fernández - 2020 - 2022 | Site generated with <a href="https://dotnet.github.io/docfx"><strong>DocFX</strong></a></center></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
